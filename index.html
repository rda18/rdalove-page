<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æˆ‘å’Œè“‰è›‹çš„çºªå¿µæ—¥</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="preload" href="music.mp3" as="audio">
  <link rel="preload" href="background.jpg" as="image">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { 
      height: 100%; 
      font-family: Arial, sans-serif; 
      color: white; 
      overflow: hidden; 
      background: 
        linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.6) 100%), 
        url('background.jpg') no-repeat center center; 
      background-size: cover; 
      background-attachment: scroll; /* ç§»åŠ¨ç«¯ scrollï¼Œé¿å…ç©ºç™½ */
      position: relative; 
    }
    .overlay { background-color: rgba(0,0,0,0.4); position: absolute; inset: 0; z-index: 1; }
    .content { position: relative; z-index: 2; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 1rem; }
    h1 { font-size: clamp(1.5rem, 4vw, 2rem); margin-bottom: 1rem; font-weight: bold; }
    .timer-container { font-size: 1.1rem; text-align: center; margin-bottom: 0.5rem; }
    .timer-container > div:first-child { margin-bottom: 10px; }
    .heart { display: inline-block; font-size: 2rem; animation: heartbeat 1.5s ease-in-out infinite; transform-origin: center; }
    @keyframes heartbeat { 0%,20%,40%,100%{transform:scale(1);} 10%,30%{transform:scale(1.3);} }
    .quote { font-size: 1rem; margin-top: 1rem; max-width: 80%; line-height: 1.5; font-style: italic; min-height: 2.5rem; white-space: pre-wrap; position: relative; word-break: break-word; }
    .quote::after { content: "|"; position: absolute; animation: blink 1s infinite; }
    @keyframes blink { 0%,50% { opacity: 1; } 51%,100% { opacity: 0; } }
    .music-control { margin-top: 1.5rem; }
    .music-control button { padding: .6rem 1.2rem; font-size: 1rem; border: none; border-radius: .5rem; cursor: pointer; background-color: rgba(255,255,255,.2); color: white; transition: .3s; }
    .music-control button:hover { background-color: rgba(255,255,255,.4); }
    .particles { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
    audio { display: none; }

    /* å¹³æ¿åŠä»¥ä¸Šï¼šå…è®¸ fixed èƒŒæ™¯ */
    @media (min-width: 768px) {
      body { background-attachment: fixed; }
      h1 { font-size: clamp(2rem, 5vw, 3rem); }
      .content { padding: 2rem; }
      .quote { max-width: 60%; font-size: 1.2rem; }
    }

    @media (min-width: 1024px) {
      h1 { font-size: clamp(2.5rem, 6vw, 4rem); }
      .quote { max-width: 50%; }
      .music-control button { padding: 0.8rem 1.5rem; font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <div class="overlay"></div>
  <canvas class="particles"></canvas>
  <div class="content">
    <h1>å’Œè“‰è›‹åœ¨ä¸€èµ·çš„ç¬¬ <span id="loveDays"></span> å¤© <span class="heart">â¤ï¸</span></h1>
    <div class="timer-container" id="beijingTimeContainer">
      <div id="datePart"></div>
      <div id="timePart"></div>
    </div>
    <div class="quote" id="quote"></div>
    <div class="music-control">
      <button id="musicToggle">æ’­æ”¾éŸ³ä¹ ğŸµ</button>
    </div>
  </div>
  <audio id="bgm" loop preload="auto">
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <script>
    (function() {
      "use strict";

      const CONFIG = {
        startDate: new Date("2024-02-09T00:00:00Z"),
        quotes: [
          "æœ‰ä½ åœ¨çš„æ—¥å­ï¼Œæ¯ä¸€å¤©éƒ½æ˜¯æƒ…äººèŠ‚ã€‚",
          "ä½ ç¬‘èµ·æ¥çš„æ ·å­ï¼Œæ˜¯æˆ‘è§è¿‡æœ€ç¾çš„é£æ™¯ã€‚",
          "é™ªä½ èµ°è¿‡çš„æ¯ä¸€æ­¥ï¼Œéƒ½æ˜¯æˆ‘æœ€çè´µçš„å›å¿†ã€‚",
          "æ—¶é—´ä¼šè€å»ï¼Œä½†æˆ‘ä»¬çš„çˆ±ä¸ä¼šã€‚",
          "æ˜Ÿæ²³æ»šçƒ«ï¼Œä½ æ˜¯äººé—´ç†æƒ³ã€‚",
          "æˆ‘è§è¿‡çš„é£æ™¯å¾ˆå¤šï¼Œä½†æœ€å–œæ¬¢çš„è¿˜æ˜¯ä½ ã€‚",
          "æˆ‘çš„çœ¼é‡Œåªæœ‰ä½ ï¼Œå…¶ä»–äººéƒ½åªæ˜¯èƒŒæ™¯ã€‚",
          "æˆ‘çˆ±ä½ ï¼Œæ˜¯ä»æˆ‘çœ‹åˆ°ä½ çš„é‚£ä¸€åˆ»å¼€å§‹ï¼Œç›´åˆ°æ°¸è¿œã€‚",
          "æ²¡æœ‰ä½ ï¼Œæˆ‘çš„ä¸–ç•Œç©ºæ— ä¸€ç‰©ã€‚",
          "ä½ æ˜¯æˆ‘ä»Šç”Ÿæœ€ç¾çš„å¥‡è¿¹ã€‚",
          "æ¯å¤©é†’æ¥ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æƒ³ä½ ï¼Œæœ€åä¸€ä»¶äº‹ä¹Ÿæ˜¯ä½ ã€‚",
          "ä½ å°±æ˜¯æˆ‘æ‰€æœ‰çš„å¹¸ç¦ï¼Œå”¯ä¸€çš„å¹¸ç¦ã€‚",
          "åœ¨ä¸€èµ·ï¼Œæ˜¯æœ€ç¾å¥½çš„ç›¸é‡ã€‚",
          "ä½ çš„ä¸€å¥â€œæˆ‘çˆ±ä½ â€ï¼Œå°±æ˜¯æˆ‘ä¸€ç”Ÿæœ€ç¾çš„æ‰¿è¯ºã€‚",
          "çˆ±ä½ æ˜¯æˆ‘è¿™è¾ˆå­æœ€å¹¸è¿çš„äº‹ã€‚",
          "åªè¦ä½ åœ¨ï¼Œä¸–ç•Œå°±è¶³å¤Ÿå®Œç¾ã€‚",
          "é‡è§ä½ æ˜¯æˆ‘ç”Ÿå‘½ä¸­çš„å¥‡è¿¹ã€‚",
          "æˆ‘çˆ±ä½ ï¼Œç›´åˆ°æ—¶é—´çš„å°½å¤´ã€‚"
        ]
      };

      const loveDaysEl = document.getElementById("loveDays");
      const datePartEl = document.getElementById("datePart");
      const timePartEl = document.getElementById("timePart");
      const quoteEl = document.getElementById("quote");
      const audio = document.getElementById("bgm");
      const toggleBtn = document.getElementById("musicToggle");
      const canvas = document.querySelector(".particles");
      const ctx = canvas.getContext("2d");
      let particles = [];
      let shuffledQuotes = [...CONFIG.quotes].sort(() => Math.random() - 0.5);
      let quoteIndex = 0;

      function throttle(fn, delay) {
        let timer;
        return function() {
          if (!timer) {
            timer = setTimeout(() => { fn(); timer = null; }, delay);
          }
        };
      }

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const particleCount = window.innerWidth < 768 ? 15 : 30;
        if (particles.length !== particleCount) {
          particles = Array.from({ length: particleCount }, createParticle);
        }
      }

      function createParticle() {
        return {
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.min(10 * Math.random() + 10, window.innerWidth * 0.02),
          speed: Math.random() + 0.5,
          opacity: Math.random()
        };
      }

      function drawParticles() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "rgba(255,100,150,0.6)";
        ctx.font = "15px sans-serif";
        particles.forEach(p => {
          ctx.globalAlpha = p.opacity;
          ctx.fillText("â¤", p.x, p.y);
          p.y -= p.speed;
          if (p.y < -20) Object.assign(p, createParticle(), { y: canvas.height + 10 });
        });
        ctx.globalAlpha = 1;
      }

      function updateLoveDays() {
        const now = new Date();
        const loveDays = Math.floor((Date.UTC(now.getFullYear(), now.getMonth(), now.getDate()) - Date.UTC(CONFIG.startDate.getFullYear(), CONFIG.startDate.getMonth(), CONFIG.startDate.getDate())) / 86400000);
        loveDaysEl.textContent = loveDays;
        const nextDay = new Date(Date.UTC(now.getFullYear(), now.getMonth(), now.getDate() + 1));
        setTimeout(updateLoveDays, nextDay - now);
      }

      function updateBeijingTime() {
        const now = new Date();
        const formatter = new Intl.DateTimeFormat('zh-CN', {
          timeZone: 'Asia/Shanghai',
          year: 'numeric', month: '2-digit', day: '2-digit',
          weekday: 'long', hour: '2-digit', minute: '2-digit', second: '2-digit',
          hour12: false
        });
        const parts = formatter.formatToParts(now);
        const year = parts.find(p => p.type === 'year').value;
        const month = parts.find(p => p.type === 'month').value;
        const day = parts.find(p => p.type === 'day').value;
        const weekday = parts.find(p => p.type === 'weekday').value;
        const hours = parts.find(p => p.type === 'hour').value;
        const minutes = parts.find(p => p.type === 'minute').value;
        const seconds = parts.find(p => p.type === 'second').value;
        datePartEl.textContent = `${year}å¹´${month}æœˆ${day}æ—¥ ${weekday}`;
        timePartEl.textContent = `${hours}:${minutes}:${seconds}`;
      }

      function typeWriter(text, callback) {
        quoteEl.innerHTML = '';
        let i = 0;
        const interval = setInterval(() => {
          quoteEl.innerHTML += text.charAt(i);
          i++;
          if (i >= text.length) {
            clearInterval(interval);
            if (callback) setTimeout(callback, 2000);
          }
        }, 210);
      }

      function playQuotes() {
        const quote = shuffledQuotes[quoteIndex];
        typeWriter(quote, () => {
          quoteIndex = (quoteIndex + 1) % shuffledQuotes.length;
          if (quoteIndex === 0) shuffledQuotes = [...CONFIG.quotes].sort(() => Math.random() - 0.5);
          playQuotes();
        });
      }

      function fadeAudio(targetVolume, duration = 1000, callback) {
        const startVolume = audio.volume;
        const startTime = performance.now();
        function step(now) {
          const progress = Math.min((now - startTime) / duration, 1);
          audio.volume = startVolume + (targetVolume - startVolume) * progress;
          if (progress < 1) {
            requestAnimationFrame(step);
          } else if (callback) callback();
        }
        requestAnimationFrame(step);
      }

      function tryAutoPlay() {
        audio.volume = 0;
        audio.play().then(() => {
          fadeAudio(1, 2000);
          toggleBtn.textContent = "æš‚åœéŸ³ä¹ â¸ï¸";
        }).catch(() => {
          toggleBtn.textContent = "æ’­æ”¾éŸ³ä¹ ğŸµ";
        });
      }

      toggleBtn.addEventListener("click", () => {
        if (audio.paused) {
          audio.play().then(() => {
            fadeAudio(1, 2000);
            toggleBtn.textContent = "æš‚åœéŸ³ä¹ â¸ï¸";
          });
        } else {
          fadeAudio(0, 1500, () => {
            audio.pause();
            toggleBtn.textContent = "æ’­æ”¾éŸ³ä¹ ğŸµ";
          });
        }
      });

      toggleBtn.addEventListener("touchstart", () => {}, { passive: true });

      function animateParticles() {
        drawParticles();
        requestAnimationFrame(animateParticles);
      }

      addEventListener("resize", throttle(resizeCanvas, 200));
      resizeCanvas();

      document.addEventListener("DOMContentLoaded", () => {
        tryAutoPlay();
        playQuotes();
        updateLoveDays();
        updateBeijingTime();
        setInterval(updateBeijingTime, 1000);
      });

      animateParticles();
    })();
  </script>
</body>
</html>
